---
layout: post
title:  "【CDN】AWS Lightsail CDN测试（免费一年）"
date:   2020-12-10-8:20:50
categories: ML
tags: Margin
excerpt: 前几天在上管理Lightsail的时候偶然看到上面的广告写了个Lightsail CDN，AWS的一贯机翻没有让人失望，博主在这里愣了一小会才反应过来……
mathjax: true
---
AWS自己家的CDN就是CloudFront，这次的Lightsail CDN属于捆绑Lightsail销售的简化版CloudFront，那么就从价格、后台以及节点三个方面做个简单做个体验和介绍。
一、价格
Lightsail作为AWS入门级产品线，产品都是按套餐售卖的，相比于AWS自身那种按量付费来说，更适合个人站点有计划地使用。当然说实在这个CDN的价格一点都不亲民，最低也是0.07USD/G，不过放在云服务商里面价格还算可以了。

官方最低的2.5USD套餐提供了一年的免费体验，每月有50G的流量；关于超出流量的具体费用官方文档暂时没有提供一个收费列表，按他的描述应该是按照CDN边缘节点所在区域的超流量价格进行计费，不会自动停机。

当数据传入和传出计入您的实例数据传输配额时，只会将数据传出计入您的分发配额。此外，超出分发配额的所有数据传出将收取超额费用，而有些类型的数据传出对实例来说是免费的。最后，Lightsail 分发使用不同的区域超额模型，尽管大多数费率与实例数据传输超额的费率相同。



二、体验
首先就是AWS的机翻看着非常迷，把内容分发网络（CDN）直接翻译成了“分配”，从联网选项卡下进入创建分配即可。



首先是源站的设置，必须选择带有绑定公网IP的Lightsail，同时设置好回源是HTTP还是HTTPS；当然这就是前面的捆绑销售的意思，源站只能使用AWS的Lightsail，没法指定。



然后就是设置缓存和选择套餐，建立流程就这样完成了，整个交互流程很干净利落。



缓存能设置的项目很有限，简化到只有缓存时间、允许的请求头、缓存范围这几种功能，至于防CC攻击这种完全没有看到



当然可以分目录进行是否缓存的设定，不过这个比CF的页面规则功能鸡肋太多了。



绑定自己的域名会要求强制开启SSL，SSL的证书签发只需要你自己添加一条CNAME验证一下域名所有权即可，不支持自己上传证书；整个签发过程也就几分钟，这个速度是非常可以的。



自动下发的证书是AWS自己的CA的签发的，有效期一年，证书链略长，根证书不在360那个啥根证书计划里面……



三、节点
AWS的CloudFront没有使用Anycast技术，所以节点都是分布在各地的AWS机房节点，他默认的DNS解析是按照地理位置远近分配的，有时候不太合理。个人建议自己通过阿里云、华为云等的DNS对国内进行分线路解析，这里简单推荐一下解析的节点。

电信
13.225.146.17（洛杉矶163）
13.32.54.37（日本163）
13.227.241.39（新加坡163）

联通
13.225.146.17（洛杉矶CUG）
13.32.54.37（日本NTT）

移动
54.192.16.59（香港NTT）
13.32.54.37（日本EQUINIX）

教育网
54.192.16.59 （香港Telstra）
2406:da1e:660:6520:3dac:fbf1:ade7:7078（香港HKIX）

科技网
54.192.16.59 （香港HKIX）
2406:da1e:660:6520:3dac:fbf1:ade7:7078（香港HKIX）

AWS的CDN网络整体来说链路比CF是好很多的，但是AWS日本、新加坡到电信因为容量不足部分区域有概率会走NTT去，导致访问异常缓慢；联通日本偶尔出现绕北美TATA的现象，不过比较少。除了教育网和科技网就不要为其他的运营商解析IPv6了，会严重拖慢访问速度的。

四、结语
一个月50G流量是不太多，而且强制绑定了Lightsail销售，也就是说实际付费的话你的最低消费是3.5+2.5=6刀，不是特别划算；当然如果你有在用Lightsail的话来体验一下也是相当不错的，腾讯云的海外CDN就是租赁的CloudFront的节点，50G足够一般的个人网站使用了。

当然有些人总想拿CDN干些别的事情，这里一并帮你测了，它是支持WebSocket的；另外就是从头到尾我都没有发现任何关于防CC的相关功能，所以肯定不能用作防护，而且这点流量被C的话真的就是一晚上房子没了。

